{% extends 'base.html.twig' %}

{% block title %}RollCardPlay - Pages des quêtes{% endblock %}

{% block body %}


    <div class="jumbotron p-3 p-md-5 text-white rounded bg-dark" style="background-image:url({{ asset('ressources/Ug4CGKC-min.jpg') }}); background-size: cover;background-position: center;">
        <div class="col-md-6 px-0" style="padding: 50px;">
            <h1 class="display-4 font-italic">Page des quêtes</h1>
            <p class="lead my-3">Sur cet page vous pourrez visualiser, editer, supprimer ou créer de nouvelle <strong>quêtes</strong> ainsi que les lancer pour tenter d'obtenir des <strong>récompenses</strong>.</p>
            <a class="btn btn-primary" href="{{ path('quest_create', {id: 0}) }}" title="create-quest"><strong>Créer</strong> une quête</a>
        </div>
    </div>
    <div class="container" style="">
    {% for message in app.flashes('succes') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}
    {{ form_start(form) }}
    <div class="form-row">
        <div class="col">
        {{ form_row(form.maxDeDifficult) }}
        </div>
        <div class="col">
        {{ form_row(form.minDeDifficult) }}
        </div>
        <div class="col">
        <button class="btn btn-primary">rechercher</button>
        </div>
    </div>
    {{ form_end(form) }}
    <div class="container" style="">
        <p class="lead my-3">Les quêtes présentes sont utilisable des maintenant, Toutes les quêtes validé pourrons être utilisé par touts les joueurs.
        Bien sur les quêtes ne peuvent êtes supprimé et edité que par leur <strong>créateur</strong> ou bien des admins. </p>
        <div class="row" id="div3" style="display:none;">
            <div class="navigation col-12" style="display: inline-block;">
                {{ knp_pagination_render(quest) }}
            </div>
            {% for quests in quest %}
                <!-- <div class="col-12 col-md"> -->
                <div class="d-flex  justify-content-center col-12 col-sm-12 col-md-6 col-lg-6 col-xl-4" style="padding: 30px;">
                    <div class="card " style="width: 18rem;padding: 10px;">
                        <img class="card-img-top rounded img-fluid img-thumbnail" align="middle" style="width: 17rem;height: auto;margin: auto auto;" src="{{ vich_uploader_asset(quests, 'imageFile') }}" alt="image-de-quest">
                            <div class="card-body">
                                <ul class="list-group list-group-flush ">
                                    <li class="list-group-item list-group-item-action"><h5 class="card-title"> {{ quests.title }} </h5></li>
                                    <li class="list-group-item list-group-item-action  flex-column align-items-start">
                                        <div class="d-flex w-100 justify-content-between">
                                            <p class="card-text">{{ quests.description|slice(0,200)  ~  "..." }}</p>
                                            <small>3 days ago</small>
                                        </div>
                                    </li>
                                    <li class="list-group-item list-group-item-action">
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="list-group" id="list-tab" role="tablist">
                                                    <a class="list-group-item list-group-item-action" id="list-profile-list{{ quests.id }}" data-toggle="list" href="#list-profile{{ quests.id }}" role="tab" aria-controls="profile{{ quests.id }}" title="name-quest">Nom du lieu</a>
                                                    <a class="list-group-item list-group-item-action" id="list-messages-list{{ quests.id }}" data-toggle="list" href="#list-messages{{ quests.id }}" role="tab" aria-controls="messages{{ quests.id }}" title="difficult-quest">Difficulté</a>
                                                    <a class="list-group-item list-group-item-action" id="list-settings-list{{ quests.id }}" data-toggle="list" href="#list-settings{{ quests.id }}" role="tab" aria-controls="settings{{ quests.id }}" title="monster-quest">Monstres</a>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="list-group-item list-group-item-action">
                                        <div class="col-12">
                                            <div class="tab-content" id="nav-tabContent">
                                                <div class="tab-pane fade" id="list-profile{{ quests.id }}" role="tabpanel" aria-labelledby="list-profile-list{{ quests.id }}">Nom du lieu : {{ quests.titlezone }}
                                                </div>
                                                <div class="tab-pane fade" id="list-messages{{ quests.id }}" role="tabpanel" aria-labelledby="list-messages-list{{ quests.id }}">Difficulté : {{ quests.dedifficult }} / 100
                                                </div>
                                                <div class="tab-pane fade" id="list-settings{{ quests.id }}" role="tabpanel" aria-labelledby="list-settings-list{{ quests.id }}">Monstres potentiellement présent :
                                                    <ul>
                                                        {% for monsters in quests.monsters %}
                                                            <li>{{ monsters.name }}</li>
                                                        {% endfor %}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    {% if quests.createur == user.id or user.hasGroup("superadmin") %}
                                        <li class="list-group-item list-group-item-action  d-flex justify-content-between align-items-center">
                                            <a href="{{ path('quest_edit', {id: quests.id}) }}" class="btn btn-primary" title="edit-quest">editer</a> 
                                            {{ include('quest/_delete_form.html.twig') }}
                                        </li>
                                    {% endif %}
                                    {% if quests.questrequismany in user.objet or quests.questrequismany is empty %}
                                        <li class="list-group-item" style="padding: 55px;">
                                            <a href="{{ path('player_choixjoueur', {id: 0, action: '0', quest: quests.id, cible: '0', tour: '0'}) }}" class="btn btn-success" title="launch-quest">Lancer la quête</a> 
                                        </li>
                                    {% else %}
                                        <li class="list-group-item" style="padding: 55px;">
                                            <p class="btn btn-danger">Besoin de l'<strong>objet</strong> {{ quests.questrequismany.name }} pour lancer cet quête </p>
                                        </li>
                                    {% endif  %}
                                    <!--SUPER LIKE -->
                                    <a href="{{ path('post_like_quest', {'id': quests.id}) }}" class="btn btn-link js-like" title="like-quest">
                                        <div style="display: inline">
                                            {% if app.user and quests.isLikedByUser(app.user) %}
                                                <i class="fas fa-thumbs-up idelta"></i>
                                            {% else %}
                                                <i class="far fa-thumbs-up idelta"></i>
                                            {% endif %}
                                            <span class="js-likes">{{ quests.likes | length }}</span>
                                            <span class="js-label" >J'aime</span>
                                            <p style="opacity:0;">{{ path('post_likereload_quest', {'id': quests.id}) }}</p>
                                        </div>

                                    </a>
                                </ul>
                            </div>
                        </div>
                    </div>
            {% endfor %}
            <div class="navigation col-12" style="display: inline-block;">
                {{ knp_pagination_render(quest) }}
            </div>
        </div>
    </div>



{% endblock %}
{% block javascripts %}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  function onClickBtnLike(event){
    event.preventDefault();
    const url = this.href;
    const spanCount = this.querySelector('span.js-likes');
    const icone = this.querySelector('i');
    axios.get(url).then(function(response){
      const likes = response.data.likes;
      spanCount.textContent = likes;
      if(icone.classList.contains('fas')) {
         icone.classList.replace('fas','far');
         }else{
          icone.classList.replace('far','fas');
         }
    });
  }
  document.querySelectorAll('a.js-like').forEach(function(link){
    link.addEventListener('click', onClickBtnLike);
  })

  /*test de reload auto*/
  /*window.setTimeout(test,10000);
  function test(){
  document.querySelectorAll('a.js-like').forEach(function(link){
    const icone = link.querySelector('i');
    const textp = link.querySelector('p');
    const url = textp.textContent;
    const spanCount = link.querySelector('span.js-likes');
    axios.get(url).then(function(response){
      const likes = response.data.likes;
      spanCount.textContent = likes;
    });
  })
  window.setTimeout(test,10000);
  }*/
</script>
  {% endblock %}